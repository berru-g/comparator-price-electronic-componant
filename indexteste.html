<!DOCTYPE html>
<html>
<head>
	<title>Comparateur de prix de composants électroniques</title>
	<style>
		
	</style>
</head>
<body>
	<header>
		<a href="#">
			<img src="logo.png" alt="Logo">
		</a>
		<nav>
			<select>
				<option value="https://www.taydaelectronics.com/">Tayda Electronics</option>
				<option value="https://www.amazon.com/">Amazon</option>
				<option value="https://www.aliexpress.com/">AliExpress</option>
			</select>
		</nav>
	</header>
	<main>
		<div>
			<input type="text" id="searchInput" placeholder="Rechercher...">
			<button id="searchButton">Comparer</button>
		</div>
		<div class="results" id="resultsDiv">
		</div>
	</main>
	<script>
		const sites = [
	"https://www.taydaelectronics.com/",
	"https://www.amazon.com/",
	"https://www.aliexpress.com/"
];

document.getElementById("searchButton").addEventListener("click", () => {
	const searchText = document.getElementById("searchInput").value.trim();
	if (searchText === "") {
		return;
	}

	const resultsDiv = document.getElementById("resultsDiv");
	resultsDiv.innerHTML = "";
	resultsDiv.style.display = "block";

	const xhrs = sites.map((site) => {
		return new Promise((resolve) => {
			const xhr = new XMLHttpRequest();
			xhr.onreadystatechange = () => {
				if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
					resolve(xhr.responseText);
				}
			};
			xhr.open("GET", site + "?q=" + searchText, true);
			xhr.send();
		});
	});

	Promise.all(xhrs).then((responses) => {
		const prices = responses.map((response, index) => {
			switch (index) {
				case 0: // Tayda Electronics
					const taydaRegex = /<div class="product-details">\s+<a href=".+?">\s+<h5>(.+?)<\/h5>\s+<\/a>\s+<span class="price">(.+?)<\/span>/g;
					const taydaMatches = [...response.matchAll(taydaRegex)];
					if (taydaMatches.length > 0) {
						const taydaMatch = taydaMatches[0];
						return {
							site: "Tayda Electronics",
							name: taydaMatch[1],
							price: parseFloat(taydaMatch[2].replace(/[^0-9\.]+/g, ""))
						};
					}
					break;

				case 1: // Amazon
					const amazonRegex = /<a class="a-link-normal a-text-normal" href="(.+?)"[^>]*>\s+<span class="a-size-base-plus a-color-base a-text-normal">\s+(.+?)\s+<\/span>\s+<\/a>\s+<span class="a-price">\s+<span class="a-offscreen">\$(.+?)<\/span>/g;
					const amazonMatches = [...response.matchAll(amazonRegex)];
					if (amazonMatches.length > 0) {
						const amazonMatch = amazonMatches[0];
						return {
							site: "Amazon",
							name: amazonMatch[2],
							price: parseFloat(amazonMatch[3])
						};
					}
					break;

				case 2: // AliExpress
					const aliRegex = /"title":"(.+?)","price":"(.+?)"/g;
					const aliMatches = [...response.matchAll(aliRegex)];
					if (aliMatches.length > 0) {
						const aliMatch = aliMatches[0];
						return {
							site: "AliExpress",
							name: aliMatch[1],
							price: parseFloat(aliMatch[2])
						};
					}
					break;
			}
			return null;
		}).filter((price) => price !== null);

		prices.sort((a, b) => a.price - b.price);

		if (prices.length === 0) {
			resultsDiv.innerHTML = "<p>Aucun résultat trouvé.</p>";
		} else {
			for (let i = 0; i < Math.min(prices.length, 3); i++) {
				const resultDiv = document.createElement("div");
                const result = document.createElement("div");
				result.classList.add("result");
				result.innerHTML = `
					<p><strong>${prices[i].name}</strong></p>
					<p>${prices[i].site}</p>
					<p>${prices[i].price.toFixed(2)} €</p>
				`;
				resultsDiv.appendChild(result);
			}
		}
	}).catch((error) => {
		console.error(error);
		resultsDiv.innerHTML = "<p>Une erreur est survenue lors de la recherche.</p>";
	});
});
</script>